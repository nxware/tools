<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Countdown</title>
  <meta name="description" content="Großer Countdown zu einem Termin. Übergabe per GET-Parameter date=yyyy-mm-dd. Unterstützt Light/Dark Mode." />
  <style>
    :root{
      --bg: 255 255 255;
      --fg: 10 10 10;
      --muted: 110 110 110;
      --accent: 38 99 235;
      --radius: 16px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg: 12 12 14;
        --fg: 237 237 241;
        --muted: 160 160 170;
      }
    }

    html,body{height:100%;}
    body{
      margin:0;
      background-color:rgb(var(--bg));
      color:rgb(var(--fg));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .card{
      width:100%;
      max-width:1100px;
      border-radius:var(--radius);
      padding:28px;
      box-sizing:border-box;
      text-align:center;
      box-shadow:0 6px 30px rgba(0,0,0,0.06);
      background: linear-gradient(180deg, rgba(var(--bg),0.6), rgba(var(--bg),0.9));
      backdrop-filter: blur(6px);
    }

    h1{
      margin:0 0 8px 0;
      font-size:20px;
      font-weight:600;
      color:rgb(var(--fg));
    }
    p.lead{
      margin:0 0 20px 0;
      color:rgb(var(--muted));
      font-size:14px;
    }

    .countdown{
      display:flex;
      gap:18px;
      justify-content:center;
      align-items:stretch;
      flex-wrap:wrap;
    }

    .unit{
      min-width:120px;
      padding:18px 20px;
      border-radius:12px;
      background:rgba(0,0,0,0.04);
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.02);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
    }
    @media (prefers-color-scheme: dark){
      .unit{ background: rgba(255,255,255,0.03); }
    }

    .value{
      font-size:56px;
      line-height:1;
      font-weight:700;
      letter-spacing:-1px;
    }
    .label{
      margin-top:6px;
      color:rgb(var(--muted));
      font-size:13px;
      text-transform:uppercase;
      font-weight:600;
      letter-spacing:1px;
    }

    .small{
      font-size:13px;
      color:rgb(var(--muted));
      margin-top:18px;
    }

    .error{
      color: #b00020;
      margin-top:18px;
      font-weight:600;
    }

    .controls{ margin-top:18px; display:flex; gap:8px; justify-content:center; }
    .btn{ border:0; padding:8px 12px; border-radius:10px; background:transparent; cursor:pointer; color:rgb(var(--accent)); font-weight:600; }

    @media (max-width:640px){
      .value{ font-size:40px; }
      .unit{ min-width:90px; padding:12px; }
    }
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1 id="title">Countdown</h1>
    <p class="lead" id="subtitle">Die Seite zeigt einen Countdown zum per URL übergebenen Datum (date=yyyy-mm-dd).</p>

    <section aria-live="polite" aria-atomic="true">
      <div id="countdown" class="countdown" role="timer">
        <!-- Units injected by JS -->
      </div>
    </section>

    <div id="message" class="small" role="status"></div>
    <div id="error" class="error" aria-hidden="true"></div>

    <div class="controls">
      <button class="btn" id="example">Beispiel-URL</button>
      <button class="btn" id="reload">Neu laden</button>
    </div>
  </main>

  <script>
    (function(){
      'use strict';

      const params = new URLSearchParams(location.search);
      const dateParam = params.get('date');
      const countdownEl = document.getElementById('countdown');
      const messageEl = document.getElementById('message');
      const errorEl = document.getElementById('error');
      const titleEl = document.getElementById('title');
      const subtitleEl = document.getElementById('subtitle');

      function parseYMD(s){
        if(!s) return null;
        // accept yyyy-mm-dd, optionally with spaces
        const m = s.trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);
        if(!m) return null;
        const y = Number(m[1]), mo = Number(m[2]), d = Number(m[3]);
        // basic validity
        if(mo < 1 || mo > 12) return null;
        if(d < 1 || d > 31) return null;
        // construct local date at midnight
        const dt = new Date(y, mo-1, d, 0, 0, 0, 0);
        // check if month/day rolled over
        if(dt.getFullYear() !== y || dt.getMonth() !== mo-1 || dt.getDate() !== d) return null;
        return dt;
      }

      const target = parseYMD(dateParam);

      function pad(n){ return String(n).padStart(2,'0'); }

      function renderUnits(t){
        // t in milliseconds
        if(t < 0) t = 0;
        const sec = Math.floor(t/1000);
        const days = Math.floor(sec / 86400);
        const hours = Math.floor((sec % 86400) / 3600);
        const minutes = Math.floor((sec % 3600) / 60);
        const seconds = sec % 60;

        const parts = [
          {v: days, l: 'Tage'},
          {v: hours, l: 'Stunden'},
          {v: minutes, l: 'Minuten'},
          {v: seconds, l: 'Sekunden'}
        ];

        countdownEl.innerHTML = '';
        parts.forEach(p => {
          const unit = document.createElement('div');
          unit.className = 'unit';
          const val = document.createElement('div'); val.className='value'; val.textContent = p.v;
          const lab = document.createElement('div'); lab.className='label'; lab.textContent = p.l;
          unit.appendChild(val); unit.appendChild(lab);
          countdownEl.appendChild(unit);
        });
      }

      let timerId = null;

      if(!dateParam){
        titleEl.textContent = 'Kein Datum übergeben';
        subtitleEl.textContent = 'Bitte übergeben Sie das Ziel-Datum per GET-Parameter: ?date=yyyy-mm-dd';
        errorEl.textContent = '';
        renderExample();
      } else if(!target){
        titleEl.textContent = 'Ungültiges Datum';
        subtitleEl.textContent = '';
        errorEl.textContent = 'Der Parameter date muss im Format yyyy-mm-dd sein (z. B. ?date=2025-12-31).';
        renderExample();
      } else {
        // target is local midnight of that date
        function update(){
          const now = new Date();
          // compute difference to *start* of target date local time
          const diff = target.getTime() - now.getTime();
          renderUnits(diff);

          if(diff <= 0){
            messageEl.textContent = 'Der Termin ist erreicht.';
            clearInterval(timerId);
            timerId = null;
          } else {
            const daysLeft = Math.ceil(diff / (24*60*60*1000));
            messageEl.textContent = `Ziel: ${target.toLocaleDateString()} — noch ${daysLeft} Tag(e)`;
          }
        }
        titleEl.textContent = 'Countdown zum Termin';
        subtitleEl.textContent = `Ziel: ${target.toLocaleDateString()}`;
        errorEl.textContent = '';
        update();
        timerId = setInterval(update, 1000);
      }

      function renderExample(){
        messageEl.innerHTML = 'Beispiel: <code>?date=2025-12-31</code> — Datum wird lokal interpretiert (Mitternacht Ortszeit).';
      }

      document.getElementById('example').addEventListener('click', function(){
        const sample = '?date=' + (new Date().getFullYear()+1) + '-12-31';
        location.href = location.pathname + sample;
      });

      document.getElementById('reload').addEventListener('click', function(){ location.reload(); });

      // Accessibility: keyboard focus on reload
      document.getElementById('reload').addEventListener('keyup', function(e){ if(e.key === 'Enter') location.reload(); });

    })();
  </script>
</body>
</html>
